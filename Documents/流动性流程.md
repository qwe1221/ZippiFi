流动性流程

## 一、AMM 流动性流程图

```
用户资产准备
       │
       ▼
  连接钱包 & 选择池
       │
       ▼
  流动性提供 (Deposit)
       │
       ▼
 LP 代币发放 (Liquidity Receipt)
       │
       ▼
   流动性使用
(交易/借贷/套利/收益聚合/跨链优化)
       │
       ▼
  收益与费用分配
       │
       ▼
   监控与风险管理
       │
       ▼
  流动性调整 / 迁移 / 退出
       │
       ▼
 用户提取资产 + 收益
```

------

## 二、说明文档

### 1. 背景与目标

AMM（Automated Market Maker）是去中心化金融（DeFi）生态系统的核心基础设施之一。与传统交易所不同，AMM 不依赖订单簿，而是通过公式自动调整流动性池内资产价格，实现交易匹配。最新 AMM 流动性流程结合了 Web3.0 特性，如集中流动性、跨链流动性、收益聚合和风控优化。

**目标**：

- 为交易者提供高效、低滑点的即时流动性；
- 为流动性提供者（LP）提供可观收益及额外激励；
- 自动平衡池内资产比例以反映市场价格；
- 支持集中流动性、跨链资产利用和收益优化策略；
- 引入智能监控及风控机制，降低无常损失和风险暴露。

------

### 2. 参与角色与功能

| 角色                            | 功能                                                  |
| ------------------------------- | ----------------------------------------------------- |
| **流动性提供者 (LP)**           | 存入资产到 AMM 池中获取 LP 代币，参与收益分配及奖励。 |
| **交易者 / 借贷者**             | 使用池中的流动性进行资产兑换或借贷，产生手续费。      |
| **智能合约**                    | 管理池内资产、执行交易公式、发放奖励、监控状态。      |
| **跨链聚合器 / 流动性迁移工具** | 在多链或多协议之间优化流动性配置，提高收益。          |
| **监控与治理系统**              | 实时监控风险、调整参数、触发治理提案和紧急措施。      |

------

### 3. 流程阶段详解

#### （1）用户资产准备

- **目标**：确保 LP 有足够的资产和支付 Gas 的能力。
- **步骤**：
  1. 选择提供流动性的资产对（例如 ETH/USDC、DAI/USDT）。
  2. 检查钱包余额及链原生代币（用于 Gas 支付）。
  3. 分析目标池的收益率（APR/APY）、无常损失预期、风险水平。
  4. 可进行模拟交易或使用 LP 收益计算器预测潜在收益。
- **注意**：资产准备阶段的多样化策略可降低风险，优化收益。

------

#### （2）连接钱包 & 选择池

- **目标**：绑定用户身份，并选择最优流动性池。
- **步骤**：
  1. 链接去中心化钱包（如 MetaMask、Coinbase Wallet）。
  2. 浏览可参与池列表，包括不同类型：
     - **恒定乘积池**（x·y=k，例如 Uniswap v2/v3）
     - **稳定币曲线池**（如 Curve，低滑点）
     - **集中流动性池**（v3 特色，可在指定价格区间提供流动性）
     - **跨链池**（如跨链桥或聚合 AMM）
  3. 设置资产投入比例、价格区间（集中流动性适用）及预期收益策略。
- **注意**：选择池时要关注交易深度、手续费率、流动性奖励及潜在风险。

------

#### （3）流动性提供 (Deposit)

- **目标**：将资产安全存入 AMM 池，并获得 LP 代币。
- **步骤**：
  1. 用户授权智能合约使用资产。
  2. 智能合约将资产存入池中。
  3. 系统根据投入金额及池内比例发放 LP 代币。
  4. LP 代币可进一步质押（Staking）获取额外奖励（如治理代币）。
- **公式示例**：
  - 恒定乘积：x * y = k
  - 集中流动性收益按价格区间加权计算
- **注意**：提供流动性时需考虑 **无常损失（Impermanent Loss）**，不同池类型风险不同。

------

#### （4）流动性使用

- **目标**：池内资产被交易、借贷或套利使用，实现收益。
- **步骤**：
  1. AMM 自动执行交易公式（如恒定乘积、稳定币曲线、集中流动性区间算法）。
  2. 交易者使用流动性池完成交换，借贷者使用资产。
  3. 系统记录交易手续费、奖励代币、借贷利息。
  4. 可通过跨链或跨协议聚合器优化流动性使用，提高收益。
- **收益来源**：
  - 交易手续费
  - 借贷利息
  - 协议奖励（如治理代币、流动性挖矿奖励）
- **注意**：集中流动性池在价格偏移时可能需要调整资产分布。

------

#### （5）收益与费用分配

- **目标**：公平分配流动性提供者收益。
- **步骤**：
  1. 按 LP 代币份额计算手续费收入。
  2. 额外奖励（如挖矿代币、质押奖励）按质押比例发放。
  3. 系统监控无常损失和资产波动，提供调整建议。
- **说明**：收益可自动复投以实现复利策略。

------

#### （6）监控与风险管理

- **目标**：保障 LP 资金安全，优化资产配置。
- **步骤**：
  1. 实时监控 TVL、流动性深度、交易量、滑点、资产占比。
  2. 异常情况（大额提取、价格剧烈波动）触发预警或暂停操作。
  3. 提供流动性优化建议（集中流动性区间调整、跨链迁移）。
- **技术手段**：
  - 智能合约监控事件触发
  - 价格预言机更新
  - 自动化风控脚本执行

------

#### （7）流动性调整 / 迁移 / 退出

- **目标**：LP 根据策略和风险调整资产或退出池。
- **步骤**：
  1. 使用 LP 代币兑换资产及收益。
  2. 可跨链迁移或迁移至收益更优的池。
  3. 完成退出，收益结算至钱包。
- **注意**：
  - 提前计算手续费、滑点和无常损失
  - 跨链操作注意桥接风险

------

### 4. 关键指标（简要说明）

| 指标                          | 意义                                               |
| ----------------------------- | -------------------------------------------------- |
| **TVL（Total Value Locked）** | 流动性池中总资产规模，反映池受欢迎程度及风险敞口。 |
| **流动性深度**                | 池内可交易资产量，影响滑点大小及交易体验。         |
| **交易量与手续费收入**        | 衡量池活跃度及 LP 收益水平。                       |
| **无常损失水平**              | 资产价格波动导致 LP 相对持有损失的量化指标。       |
| **流动性利用率**              | 资产被交易使用的效率，帮助优化池配置。             |
| **跨链资产分布**              | 多链资产流动性状态，有助于跨链策略优化和风险管理。 |

------

### 5. 风险控制（简要说明）

| 风险类型                  | 控制措施                                                     |
| ------------------------- | ------------------------------------------------------------ |
| **智能合约风险**          | 多方审计、Formal Verification、Bug Bounty 奖励机制。         |
| **桥接 / 跨链风险**       | 使用可靠桥接协议，多签或保险机制降低资产损失风险。           |
| **流动性碎片化**          | 集中流动性管理、流动性池优化算法降低无常损失。               |
| **价格波动与滑点**        | 使用预言机提供价格参考，限制大额交易，触发警告或暂停操作。   |
| **预警机制 & 自动化风控** | 自动监控大额交易、异常价格变化，及时通知 LP 或采取保护措施。 |